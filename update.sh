#!/bin/bash

# ะกะบัะธะฟั ะพะฑะฝะพะฒะปะตะฝะธั ะธ ะฟะตัะตะทะฐะฟััะบะฐ ะฑะพัะฐ
echo "๐ ะะฑะฝะพะฒะปะตะฝะธะต ะฑะพัะฐ..."

cd /root/telegram-reminder-bot

# ะััะฐะฝะพะฒะบะฐ ัะตะบััะตะณะพ ะฟัะพัะตััะฐ
echo "โน๏ธ ะััะฐะฝะพะฒะบะฐ ัะตะบััะตะณะพ ะฑะพัะฐ..."
pkill -f bot.py

# ะะฑะฝะพะฒะปะตะฝะธะต ะบะพะดะฐ ะธะท Git (ะตัะปะธ ะธัะฟะพะปัะทัะตััั)
if [ -d ".git" ]; then
    echo "๐ฅ ะะพะปััะตะฝะธะต ะพะฑะฝะพะฒะปะตะฝะธะน ะธะท Git..."
    git pull origin main
fi

# ะะบัะธะฒะฐัะธั ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั
echo "๐ ะะบัะธะฒะฐัะธั ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั..."
source venv/bin/activate

# ะะฑะฝะพะฒะปะตะฝะธะต ะทะฐะฒะธัะธะผะพััะตะน
echo "๐ฆ ะะฑะฝะพะฒะปะตะฝะธะต ะทะฐะฒะธัะธะผะพััะตะน..."
pip install -r requirements.txt

# ะะถะธะดะฐะฝะธะต ะทะฐะฒะตััะตะฝะธั ะฟัะตะดัะดััะธั ะฟัะพัะตััะพะฒ
sleep 2

# ะะฐะฟััะบ ะฝะพะฒะพะณะพ ะฟัะพัะตััะฐ
echo "๐ ะะฐะฟััะบ ะฑะพัะฐ..."
nohup python3 bot.py > bot.log 2>&1 &

# ะัะพะฒะตัะบะฐ ะทะฐะฟััะบะฐ
sleep 3
if pgrep -f "bot.py" > /dev/null; then
    echo "โ ะะพั ััะฟะตัะฝะพ ะทะฐะฟััะตะฝ!"
    echo "๐ ะะพะณะธ: tail -f /root/telegram-reminder-bot/bot.log"
else
    echo "โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ ะฑะพัะฐ!"
    echo "๐ ะัะพะฒะตัััะต ะปะพะณะธ: cat /root/telegram-reminder-bot/bot.log"
fi